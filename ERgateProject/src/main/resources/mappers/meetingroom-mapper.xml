<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="meetingroomMapper">

	<resultMap id="MeetingroomResultSet" type="Meetingroom">
		<id column="MTRM_CODE" property="mtrmCode"/>
		<result column="MTRM_NAME" property="mtrmName"/>
		<result column="MTRM_LOCATION" property="mtrmLocation"/>
		<result column="MTRM_CAPACITY" property="mtrmCapacity"/>
		<result column="MTRM_IMAGE" property="mtrmImage"/>
		<result column="MTRM_STATUS" property="mtrmStatus"/>
		<result column="MTRM_ENROLL_DATE" property="mtrmEnrollDate"/>
	</resultMap>
	
	<resultMap id="MeetingroomReservationResultSet" type="MeetingroomReservation" >
		<id column="MTRM_RESERV_NO" property="mtrmReservNo"/>
		<result column="EMP_ID" property="empId"/>
		<result column="MTRM_CODE" property="mtrmCode"/>
		<result column="MTRM_NAME" property="mtrmName"/>
		<result column="MTRM_RESERV_DATE" property="mtrmReservDate"/>
		<result column="MTRM_DEPT_TITLE" property="mtrmDeptTitle"/>
		<result column="MTRM_START_DATE" property="mtrmStartDate"/>
		<result column="MTRM_START_TIME" property="mtrmStartTime"/>
		<result column="MTRM_END_DATE" property="mtrmEndDate"/>
		<result column="MTRM_END_TIME" property="mtrmEndTime"/>
		<result column="MTRM_PURPOSE" property="mtrmPurpose"/>
		<result column="MTRM_RESERV_STATUS" property="mtrmReservStatus"/>
		<result column="MTRM_IMAGE" property="mtrmImage"/>
	</resultMap>

	<select id="statusListCount" resultType="_int">
		select count(*)
		  from meetingroom_reservation
		 where mtrm_reserv_status='Y'
	</select>

	<select id="statusList" resultMap="MeetingroomReservationResultSet">
		select *
		  from meetingroom_reservation
		 where mtrm_reserv_status='Y'
	</select>
	

	
	  <select id="selectMtroomDetail" resultMap="MeetingroomResultSet">
		select *
		  from meetingroom
		 where mtrm_status = 'Y'
	</select>
	
	<insert id="reserveMtroom" parameterType="MeetingroomReservation">
		insert into meetingroom_reservation 
		values(seq_mreserv_no.nextval, #{empId}, #{mtrmCode}, #{mtrmName}, SYSDATE, #{mtrmDeptTitle},
			   #{mtrmStartDate}, #{mtrmStartTime},  #{mtrmEndDate}, #{mtrmEndTime}, #{mtrmPurpose}, 'Y')
	
	</insert>
	
	<insert id="insertMeetingroom" parameterType="Meetingroom">
		INSERT INTO MEETINGROOM
		VALUES(SEQ_MROOM_NO.NEXTVAL , #{mtrmName}, #{mtrmLocation}, #{mtrmCapacity}, #{mtrmImage}, 'Y', SYSDATE)	
	</insert>

	<select id="selectRvListCount" resultType="_int">
		select count(*)
          from meetingroom_reservation
         where emp_id=#{empId}
           and mtrm_reserv_status='Y'
	</select>

	<select id="myReserveList" parameterType="string" resultMap="MeetingroomReservationResultSet">
		select mr.emp_id, m.mtrm_code, mr.mtrm_name, mr.mtrm_start_date, mr.mtrm_start_time, mr.mtrm_end_date, mr.mtrm_end_time, mr.mtrm_purpose, mr.mtrm_reserv_status, m.mtrm_image
		  from meetingroom_reservation mr,
		       meetingroom m
		 where m.mtrm_code = mr.mtrm_code
		   and emp_id = #{empId}
	</select>
	
	<update id="cancelReserve" parameterType="string">
		UPDATE MEETINGROOM_RESERVATION
		   SET MTRM_RESERV_STATUS='N'
		 WHERE MTRM_RESERV_NO=#{mtrmReservNo}
	</update>
	
	<update id="updateMeetingroom" parameterType="Meetingroom">
		update meetingroom
		   set mtrm_name=#{mtrmName},
		   	   mtrm_location=#{mtrmLocation},
		   	   mtrm_capacity=#{mtrmCapacity}
		 where mtrm_code = #{mtrmCode}
	</update>

</mapper>
